<div class="listado-wrapper">
    <div class="listado-header">
        <div>
            <h1>Empresas</h1>
            <p>Encuentra las mejores oportunidades laborales</p>
        </div>
    </div>

    <div class="buscador">
        <div class="input-search-wrapper">
            <input 
                type="text" 
                placeholder="Buscar..." 
                class="input-search"
                [(ngModel)]="texto" />
            <button id="icon-button" (click)="buscarPorNombre(texto)">
                <span class="material-symbols-outlined search-icon">search</span>
            </button>
        </div>
    </div>
    <div class="seccion-filtros">
        <div class="filtros">
            <p-multiselect
                [options]="filtrosUbicacion"
                optionLabel="name"
                optionValue="idProvincia"
                placeholder="Ubicación"
                [maxSelectedLabels]="0"
                [selectedItemsLabel]="'Ubicación ({0})'"
                class="filtro w-full md:w-80"
                [panelStyle]="{ 'background': '#fff' }"
                [(ngModel)]="filtrosSeleccionadosUbicacion">
            </p-multiselect>
            <p-multiselect
                [options]="filtrosRubro"
                optionLabel="name"
                optionValue="id"
                placeholder="Rubros"
                [maxSelectedLabels]="0"
                [selectedItemsLabel]="'Rubros ({0})'"
                class="filtro w-full md:w-80"
                [panelStyle]="{ 'background': '#fff' }"
                [(ngModel)]="filtrosSeleccionadosRubros">
            </p-multiselect>
            <p-multiselect
                [options]="filtrosOferta"
                placeholder="Ofertas abiertas"
                [maxSelectedLabels]="0"
                [selectedItemsLabel]="'Ofertas abiertas ({0})'"
                class="filtro w-full md:w-80"
                [panelStyle]="{ 'background': '#fff' }"
                [(ngModel)]="filtrosSeleccionadosOfertas">
                <!-- [(ngModel)]="filtrosSeleccionados" -->
            </p-multiselect>
        </div>
        <div class="contenedor-boton">
            <button 
            [disabled]="!filtrosSeleccionadosUbicacion.length && !filtrosSeleccionadosRubros.length && !filtrosSeleccionadosOfertas.length"
            class="boton"
            (click)="filtrarEmpresas()">
                Aplicar filtros
            </button>
        </div>
    </div>   
    <div class="listado-contenido row row-cols-1 row-cols-md-2 g-4">
        @if (empresaList.length === 0) {
            <div class="sin-resultados">
                @if (!busquedaRealizada) {
                    <img src="assets\img\buscar.png" alt="Busca empresas" class="sin-resultados-img">
                    <p class="sin-resultados-txt">
                        Busca las empresas que te interesan en Workee
                    </p>
                } @else {
                    <img src="assets\img\sin-resultados.png" alt="No hay resultados" class="sin-resultados-img">
                    <p class="sin-resultados-txt">
                        No encontramos empresas que coincidan con tu búsqueda
                    </p>
                }
            </div>
        } @else {
            @for (empresa of obtenerEmpresasPaginadas(); track $index) {
                <div class="tarjeta-empresa" (click)="irADetalle(empresa.id!)" role="button">
                    <div class="logo-container">
                        <img [src]="'assets/img/foto-empresa.png'" alt="Logo de {{ empresa.nombreEmpresa }}" />
                    </div>
                    <div class="contenido">
                        <h5 class="nombre-empresa">{{ empresa.nombreEmpresa }}</h5>
                        <p class="rubro-ubicacion">{{ empresa.rubro?.nombreRubro }} • {{ empresa.provincia?.nombreProvincia }}, {{ empresa.provincia?.pais?.nombrePais }}</p>
                        <div class="ofertas">
                            <span class="material-symbols-outlined">business_center</span>
                            @if (tieneOfertasAbiertas) {
                                <span>{{ cantidadOfertasAbiertas }} ofertas abiertas</span>
                            } @else {
                                <span>Sin ofertas abiertas</span>
                            }
                        </div>
                        
                        <p class="descripcion">
                            {{ empresa.descripcionEmpresa }}
                        </p>
                    </div>
                </div>
            }
        }
    </div>
    
    @if (totalPaginas > 1) {
        <nav class="paginador">
            <ul class="pagination justify-content-center mb-0">
                <li class="page-item" [class.disabled]="paginaActual === 1">
                    <button class="page-link" (click)="retrocederPagina()">Anterior</button>
                </li>
                <li 
                *ngFor="let pagina of paginas"
                class="page-item" 
                [class.active]="paginaActual === pagina">
                    <button class="page-link" (click)="irAPagina(pagina)">
                        {{ pagina }}
                    </button>
                </li>
                <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
                    <button class="page-link" (click)="avanzarPagina()">Siguiente</button>
                </li>
            </ul>
        </nav>
    }
</div>
